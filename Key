-- Key System GUI with draggable, clipboard loop, and best-effort "open browser" attempt
-- Place this LocalScript in StarterPlayerScripts

-- ===== SETTINGS =====
local keyLink = "https://beacons.ai/lokushub" -- change to your link
local correctKey = "VINAR-1234-KEY"               -- change to your key
local scriptToLoad = "https://pastefy.app/9o2xmDMt/raw" -- change to your loader
local discordLink = "http://dsc.gg/lokus-hub" -- ‚Üê YOUR DISCORD LINK HERE

-- ===== SERVICES =====
local Players = game:GetService("Players")
local GuiService = game:GetService("GuiService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local player = Players.LocalPlayer

-- ===== UI CREATION =====
local gui = Instance.new("ScreenGui")
gui.Name = "KeySystem"
gui.ResetOnSpawn = false
gui.Parent = player:WaitForChild("PlayerGui")

local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 380, 0, 240) -- Original height
frame.Position = UDim2.new(0.5, -190, 0.5, -120) -- Original position
frame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
frame.BorderSizePixel = 0
frame.Parent = gui
Instance.new("UICorner", frame).CornerRadius = UDim.new(0, 12)

local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, -20, 0, 36)
title.Position = UDim2.new(0, 10, 0, 6)
title.BackgroundTransparency = 1
title.Font = Enum.Font.GothamBold
title.Text = "üîë Lokus Hub Key System"
title.TextColor3 = Color3.fromRGB(255,255,255)
title.TextSize = 18
title.TextXAlignment = Enum.TextXAlignment.Left
title.Parent = frame

local keyBox = Instance.new("TextBox")
keyBox.Size = UDim2.new(0.8, 0, 0, 44)
keyBox.Position = UDim2.new(0.1, 0, 0.28, 0)
keyBox.PlaceholderText = "Enter your key here..."
keyBox.Font = Enum.Font.Gotham
keyBox.TextSize = 16
keyBox.Text = ""
keyBox.TextColor3 = Color3.new(1,1,1)
keyBox.BackgroundColor3 = Color3.fromRGB(40,40,40)
Instance.new("UICorner", keyBox).CornerRadius = UDim.new(0, 8)
keyBox.Parent = frame

local getKeyBtn = Instance.new("TextButton")
getKeyBtn.Size = UDim2.new(0.35, 0, 0, 38)
getKeyBtn.Position = UDim2.new(0.08, 0, 0.6, 0) -- Left side
getKeyBtn.Text = "üåê Get Key"
getKeyBtn.Font = Enum.Font.GothamBold
getKeyBtn.TextSize = 16
getKeyBtn.TextColor3 = Color3.new(1,1,1)
getKeyBtn.BackgroundColor3 = Color3.fromRGB(45, 110, 255)
Instance.new("UICorner", getKeyBtn).CornerRadius = UDim.new(0, 8)
getKeyBtn.Parent = frame

local submitBtn = Instance.new("TextButton")
submitBtn.Size = UDim2.new(0.35, 0, 0, 38)
submitBtn.Position = UDim2.new(0.57, 0, 0.6, 0) -- Aligned with Get Key button (right side)
submitBtn.Text = "‚úÖ Submit"
submitBtn.Font = Enum.Font.GothamBold
submitBtn.TextSize = 16
submitBtn.TextColor3 = Color3.new(1,1,1)
submitBtn.BackgroundColor3 = Color3.fromRGB(65, 180, 80)
Instance.new("UICorner", submitBtn).CornerRadius = UDim.new(0, 8)
submitBtn.Parent = frame

local discordBtn = Instance.new("TextButton")
discordBtn.Size = UDim2.new(0.35, 0, 0, 38) -- Same size as other buttons
discordBtn.Position = UDim2.new(0.08, 0, 0.78, 0) -- Below Get Key button
discordBtn.Text = "üü£ Join Discord"
discordBtn.Font = Enum.Font.GothamBold
discordBtn.TextSize = 16
discordBtn.TextColor3 = Color3.new(1,1,1)
discordBtn.BackgroundColor3 = Color3.fromRGB(88, 101, 242) -- Discord blurple color
Instance.new("UICorner", discordBtn).CornerRadius = UDim.new(0, 8)
discordBtn.Parent = frame

local status = Instance.new("TextLabel")
status.Size = UDim2.new(1, -20, 0, 36)
status.Position = UDim2.new(0, 10, 0.85, 0)
status.BackgroundTransparency = 1
status.Font = Enum.Font.Gotham
status.TextSize = 14
status.TextColor3 = Color3.fromRGB(200,200,200)
status.Text = "Waiting for input..."
status.TextWrapped = true
status.Parent = frame

-- ===== NOTIFICATION SYSTEM =====
-- Create notification GUI in top-left corner
local notificationGui = Instance.new("ScreenGui")
notificationGui.Name = "KeySystemNotifications"
notificationGui.ResetOnSpawn = false
notificationGui.Parent = player:WaitForChild("PlayerGui")

local notificationFrame = Instance.new("Frame")
notificationFrame.Size = UDim2.new(0, 300, 0, 80)
notificationFrame.Position = UDim2.new(0, 10, 0, -100) -- Start off-screen above
notificationFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
notificationFrame.BackgroundTransparency = 0.2
notificationFrame.BorderSizePixel = 0
notificationFrame.Visible = false
notificationFrame.Parent = notificationGui
Instance.new("UICorner", notificationFrame).CornerRadius = UDim.new(0, 8)

local notificationTitle = Instance.new("TextLabel")
notificationTitle.Size = UDim2.new(1, -10, 0, 25)
notificationTitle.Position = UDim2.new(0, 5, 0, 5)
notificationTitle.BackgroundTransparency = 1
notificationTitle.Font = Enum.Font.GothamBold
notificationTitle.Text = "Notification"
notificationTitle.TextColor3 = Color3.fromRGB(255,255,255)
notificationTitle.TextSize = 14
notificationTitle.TextXAlignment = Enum.TextXAlignment.Left
notificationTitle.Parent = notificationFrame

local notificationText = Instance.new("TextLabel")
notificationText.Size = UDim2.new(1, -10, 1, -35)
notificationText.Position = UDim2.new(0, 5, 0, 30)
notificationText.BackgroundTransparency = 1
notificationText.Font = Enum.Font.Gotham
notificationText.Text = ""
notificationText.TextColor3 = Color3.fromRGB(220,220,220)
notificationText.TextSize = 12
notificationText.TextXAlignment = Enum.TextXAlignment.Left
notificationText.TextWrapped = true
notificationText.Parent = notificationFrame

local notificationQueue = {}
local isShowingNotification = false

local function slideInNotification()
	if not notificationFrame then return end
	
	notificationFrame.Visible = true
	
	-- Slide down animation
	local slideInTween = TweenService:Create(
		notificationFrame,
		TweenInfo.new(0.5, Enum.EasingStyle.Back, Enum.EasingDirection.Out),
		{Position = UDim2.new(0, 10, 0, 10)}
	)
	
	-- Fade in animation
	local fadeInTween = TweenService:Create(
		notificationFrame,
		TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
		{BackgroundTransparency = 0}
	)
	
	slideInTween:Play()
	fadeInTween:Play()
end

local function slideOutNotification(callback)
	if not notificationFrame then 
		if callback then callback() end
		return 
	end
	
	-- Fade out animation
	local fadeOutTween = TweenService:Create(
		notificationFrame,
		TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
		{BackgroundTransparency = 0.2}
	)
	
	-- Slide up animation
	local slideOutTween = TweenService:Create(
		notificationFrame,
		TweenInfo.new(0.5, Enum.EasingStyle.Back, Enum.EasingDirection.In),
		{Position = UDim2.new(0, 10, 0, -100)}
	)
	
	fadeOutTween:Play()
	slideOutTween:Play()
	
	-- Wait for animation to complete
	slideOutTween.Completed:Connect(function()
		notificationFrame.Visible = false
		if callback then callback() end
	end)
end

local function processNotificationQueue()
	if isShowingNotification or #notificationQueue == 0 then return end
	
	isShowingNotification = true
	local currentNotification = table.remove(notificationQueue, 1)
	
	-- Update notification content
	notificationTitle.Text = currentNotification.title
	notificationText.Text = currentNotification.message
	
	-- Slide in
	slideInNotification()
	
	-- Wait for duration
	task.wait(currentNotification.duration or 3)
	
	-- Slide out and process next notification
	slideOutNotification(function()
		isShowingNotification = false
		processNotificationQueue()
	end)
end

local function showNotification(title, message, duration)
	-- Add to queue
	table.insert(notificationQueue, {
		title = title,
		message = message,
		duration = duration
	})
	
	-- Start processing if not already showing
	if not isShowingNotification then
		processNotificationQueue()
	end
end

-- ===== DRAGGABLE CODE =====
do
	local dragging, dragInput, dragStart, startPos
	local function update(input)
		if not dragging then return end
		local delta = input.Position - dragStart
		frame.Position = UDim2.new(
			startPos.X.Scale, startPos.X.Offset + delta.X,
			startPos.Y.Scale, startPos.Y.Offset + delta.Y
		)
	end
	
	frame.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 then
			dragging = true
			dragStart = input.Position
			startPos = frame.Position
			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then
					dragging = false
				end
			end)
		end
	end)
	
	frame.InputChanged:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseMovement then
			dragInput = input
		end
	end)
	
	UserInputService.InputChanged:Connect(function(input)
		if input == dragInput then
			update(input)
		end
	end)
end

-- ===== FUNCTIONALITY =====
local clipboardLooping = false
local lastClipboard = nil

local function safeLoadRemote(url)
	local ok, err = pcall(function()
		local code = game:HttpGet(url)
		loadstring(code)()
	end)
	return ok, err
end

local function trySubmitKey(k)
	if type(k) ~= "string" then return false end
	k = tostring(k):gsub("%s+", "")
	
	if k == correctKey then
		showNotification("‚úÖ Success", "Correct key! Loading script...", 2)
		task.wait(0.6)
		if gui and gui.Parent then gui:Destroy() end
		if notificationGui and notificationGui.Parent then notificationGui:Destroy() end
		local ok, err = safeLoadRemote(scriptToLoad)
		if not ok then
			warn("Failed to load remote script:", err)
		end
		return true
	else
		showNotification("‚ùå Error", "Invalid key. Get the correct key and copy it.", 3)
		return false
	end
end

-- Submit button
submitBtn.MouseButton1Click:Connect(function()
	local userKey = tostring(keyBox.Text):gsub("%s+", "")
	if userKey == "" then
		showNotification("‚ùå Error", "Please enter a key!", 3)
		return
	end
	trySubmitKey(userKey)
end)

-- Get Key button
getKeyBtn.MouseButton1Click:Connect(function()
	-- copy link
	if type(setclipboard) == "function" then
		pcall(setclipboard, keyLink)
		showNotification("‚úÖ Link Copied", "Key link copied to clipboard! Paste it in your browser to get the key.", 5)
	else
		showNotification("‚ö†Ô∏è Manual Copy", "Cannot copy automatically. Copy this link manually:\n" .. keyLink, 5)
	end
	
	-- Start clipboard-watching loop if available
	if type(getclipboard) == "function" and not clipboardLooping then
		clipboardLooping = true
		task.spawn(function()
			while clipboardLooping and gui and gui.Parent do
				local ok, clip = pcall(getclipboard)
				if ok and clip and clip ~= "" then
					if clip ~= lastClipboard then
						lastClipboard = clip
						-- paste and try submit
						pcall(function() keyBox.Text = tostring(clip) end)
						local success = trySubmitKey(clip)
						if success then
							clipboardLooping = false
							break
						end
					end
				end
				task.wait(1.4)
			end
		end)
	else
		showNotification("‚ö†Ô∏è Auto-paste", "Auto-paste unavailable. Paste the key manually and press Submit.", 3)
	end
end)

-- Discord button functionality
discordBtn.MouseButton1Click:Connect(function()
	if type(setclipboard) == "function" then
		pcall(setclipboard, discordLink) -- ‚Üê Now uses YOUR discord link
		showNotification("‚úÖ Discord Invite", "Discord invite link copied to clipboard!", 4)
	else
		showNotification("Discord Link", "Join our Discord:\n" .. discordLink, 5) -- ‚Üê Now shows YOUR discord link
	end
end)

-- Button hover animations
local function setupButtonHover(button)
	button.MouseEnter:Connect(function()
		local tween = TweenService:Create(
			button,
			TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
			{Size = UDim2.new(0.36, 0, 0, 40)}
		)
		tween:Play()
	end)
	
	button.MouseLeave:Connect(function()
		local tween = TweenService:Create(
			button,
			TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
			{Size = UDim2.new(0.35, 0, 0, 38)}
		)
		tween:Play()
	end)
end

-- Apply hover animations to all buttons
setupButtonHover(getKeyBtn)
setupButtonHover(submitBtn)
setupButtonHover(discordBtn)

-- Close GUI on Esc
UserInputService.InputBegan:Connect(function(input, gp)
	if gp then return end
	if input.KeyCode == Enum.KeyCode.Escape and gui and gui.Parent then
		-- Slide out animation before destroying
		local destroyTween = TweenService:Create(
			frame,
			TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
			{BackgroundTransparency = 1}
		)
		destroyTween:Play()
		
		destroyTween.Completed:Connect(function()
			gui:Destroy()
			if notificationGui and notificationGui.Parent then
				notificationGui:Destroy()
			end
		end)
	end
end)
